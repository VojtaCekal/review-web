<!DOCTYPE html>
<html>
    <head>
      <div class="admin_ramec">
        <button onclick="login()">üîê Admin p≈ôihl√°≈°en√≠</button>
        </div>
        <title>Recenze produktu</title>
        <link rel="stylesheet" href="styl.css">
    </head>
<body>
  <div class="container">
    <h1> Recenze ...</h1>

    <input type="text" id="name" placeholder="Va≈°e jm√©no">
    <input type="text" id="email" placeholder="Va≈°e emailov√° adresa">
    <textarea id="text" placeholder="Napi≈°te recenzi..."></textarea>

    <select id="rating">
      <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
      <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
      <option value="3">‚≠ê‚≠ê‚≠ê</option>
      <option value="2">‚≠ê‚≠ê</option>
      <option value="1">‚≠ê</option>
    </select>

    <button onclick="addReview()">P≈ôidat recenzi</button>


  </div>

  <footer>
    <div class="recenze_ramec">
      <div id="stats">
        <h2>‚≠ê Hodnocen√≠: <span id="avg">0</span> / 5</h2>
        <p>Poƒçet recenz√≠: <span id="count">0</span></p>
      </div>
      <h2>Recenze</h2>
         <div id="reviews"></div>

    </div>
  </footer>




<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy } 
  from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBGcNTTQ-hlpbab3lwiuzgB_BtR8RWq3Ow",
  authDomain: "recenze-86af3.firebaseapp.com",
  projectId: "recenze-86af3",
  storageBucket: "recenze-86af3.firebasestorage.app",
  messagingSenderId: "702942416836",
  appId: "1:702942416836:web:5a0208bcff52475ef3de91"
};

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const reviewsDiv = document.getElementById("reviews");
  let isAdmin = false;

  async function loadReviews() {
    reviewsDiv.innerHTML = "";
    let total = 0;
    let count = 0;

    const q = query(collection(db, "reviews"), orderBy("time", "desc"));
    const snapshot = await getDocs(q);

    snapshot.forEach((docSnap) => {
      const r = docSnap.data();
      total += Number(r.rating);
      count++;

      const div = document.createElement("div");
      div.classList.add("review");
      let stars = "‚≠ê".repeat(r.rating);

      div.innerHTML = `
        <strong>${r.name}</strong><br>
        <span class="stars">${stars}</span>
        <p>${r.text}</p>
        ${isAdmin ? `<button onclick="deleteReview('${docSnap.id}')">‚ùå Smazat</button>` : ""}
      `;
      reviewsDiv.appendChild(div);
    });

    document.getElementById("avg").textContent = count ? (total / count).toFixed(1) : 0;
    document.getElementById("count").textContent = count;
  }

  loadReviews();

  window.addReview = async function () {
    const name = document.getElementById("name").value;
    const text = document.getElementById("text").value;
    const rating = document.getElementById("rating").value;

    if (!name || !text) return alert("Vypl≈à jm√©no i recenzi!");

    await addDoc(collection(db, "reviews"), {
      name, text, rating, time: Date.now()
    });

    document.getElementById("name").value = "";
    document.getElementById("text").value = "";

    loadReviews();
  };

  window.deleteReview = async function (id) {
    await deleteDoc(doc(db, "reviews", id));
    loadReviews();
  };

  window.login = function () {
    const pass = prompt("Admin heslo:");
    if (pass === "tajne123") {
      isAdmin = true;
      loadReviews();
      alert("Admin p≈ôihl√°≈°en!");
    } else alert("≈†patn√© heslo!");
  };
</script>




</body>
</html>


